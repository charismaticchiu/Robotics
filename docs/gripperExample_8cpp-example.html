<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Aria: gripperExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>gripperExample.cpp</h1>Example program demonstrating use of the Pioneer gripper.<p>
Shows how to control the Pioneer 2DOF gripper accessory. In addition to the arrow keys to teleoperate the robot, Use the following keyboard keys to control it: u Lift the gripper up d Lift the gripper down o Open the gripper c Close the gripper s Stop gripper movement.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="classArModeGripper.html">ArModeGripper</a> (the gripper control mode used in the "demo" program)</dd></dl>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include "Aria.h"</span>

<span class="comment">// Adds robot callback to print gripper status.</span>
<span class="keyword">class </span>PrintGripStatus
{
  <a name="_a362"></a><a class="code" href="classArGripper.html">ArGripper</a>* myGripper;
  <a name="_a363"></a><a class="code" href="classArFunctorC.html">ArFunctorC&lt;PrintGripStatus&gt;</a> myPrintCB;
<span class="keyword">public</span>:
  PrintGripStatus(<a class="code" href="classArGripper.html">ArGripper</a>* gripper) : 
    myGripper(gripper),
    myPrintCB(this, &amp;PrintGripStatus::printStatus)
  {
  }

  <span class="keywordtype">void</span> addRobotTask(<a name="_a364"></a><a class="code" href="classArRobot.html">ArRobot</a>* robot)
  {
    robot-&gt;<a name="a365"></a><a class="code" href="classArRobot.html#a12">addUserTask</a>(<span class="stringliteral">"PrintGripStatus"</span>, 10, &amp;myPrintCB);
  }

  <span class="keywordtype">void</span> printStatus()
  {
    myGripper-&gt;logState();
  }
};

<span class="comment">// Adds key handler callbacks for controlling the gripper</span>
<span class="keyword">class </span>GripperControlHandler
{
  <a class="code" href="classArGripper.html">ArGripper</a>* myGripper;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myUpCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myDownCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myOpenCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myCloseCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myStopCB;
<span class="keyword">public</span>:
  GripperControlHandler(<a class="code" href="classArGripper.html">ArGripper</a>* gripper) : 
    myGripper(gripper),
    myUpCB(this, &amp;GripperControlHandler::liftUp),
    myDownCB(this, &amp;GripperControlHandler::liftDown),
    myOpenCB(this, &amp;GripperControlHandler::open),
    myCloseCB(this, &amp;GripperControlHandler::close),
    myStopCB(this, &amp;GripperControlHandler::stop)
  {
  }

  <span class="keywordtype">void</span> addKeyHandlers(<a class="code" href="classArRobot.html">ArRobot</a> *robot)
  {
    <a name="_a366"></a><a class="code" href="classArKeyHandler.html">ArKeyHandler</a> *keyHandler = <a name="a367"></a><a class="code" href="classAria.html#e18">Aria::getKeyHandler</a>();
    <span class="keywordflow">if</span>(keyHandler == NULL)
    {
      keyHandler = <span class="keyword">new</span> <a class="code" href="classArKeyHandler.html">ArKeyHandler</a>();
      <a name="a368"></a><a class="code" href="classAria.html#e33">Aria::setKeyHandler</a>(keyHandler);
      robot-&gt;<a name="a369"></a><a class="code" href="classArRobot.html#a20">attachKeyHandler</a>(keyHandler);
    }
    keyHandler-&gt;<a name="a370"></a><a class="code" href="classArKeyHandler.html#a0">addKeyHandler</a>(<a name="a371"></a><a class="code" href="classArKeyHandler.html#w22w25">ArKeyHandler::PAGEUP</a>, &amp;myUpCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#a0">addKeyHandler</a>(<span class="charliteral">'u'</span>, &amp;myUpCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#a0">addKeyHandler</a>(<a name="a372"></a><a class="code" href="classArKeyHandler.html#w22w24">ArKeyHandler::PAGEDOWN</a>, &amp;myDownCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#a0">addKeyHandler</a>(<span class="charliteral">'d'</span>, &amp;myDownCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#a0">addKeyHandler</a>(<span class="charliteral">'o'</span>, &amp;myOpenCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#a0">addKeyHandler</a>(<span class="charliteral">'c'</span>, &amp;myCloseCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#a0">addKeyHandler</a>(<span class="charliteral">'s'</span>, &amp;myStopCB);
  }

  <span class="keywordtype">void</span> liftUp()
  {
    <a name="a373"></a><a class="code" href="classArLog.html#e4">ArLog::log</a>(<a name="a374"></a><a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Moving gripper lift up..."</span>);
    myGripper-&gt;liftUp();
  }

  <span class="keywordtype">void</span> liftDown()
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Moving gripper lift down..."</span>);
    myGripper-&gt;liftDown();
  }

  <span class="keywordtype">void</span> stop()
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Stopping gripper..."</span>);
    myGripper-&gt;gripperHalt(); <span class="comment">// stops both lift an grip</span>
    <span class="comment">//myGripper-&gt;liftStop(); // stops just the lift</span>
    <span class="comment">//myGripper-&gt;gripStop(); // stops just the gripper</span>
  }

  <span class="keywordtype">void</span> close()
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Closing gripper..."</span>);
    myGripper-&gt;gripClose();
  }

  <span class="keywordtype">void</span> open()
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Opening gripper..."</span>);
    myGripper-&gt;gripOpen();
  }

};

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) 
{

  <a name="a375"></a><a class="code" href="classAria.html#e23">Aria::init</a>();
  <a class="code" href="classArRobot.html">ArRobot</a> robot;
  <a name="_a376"></a><a class="code" href="classArArgumentParser.html">ArArgumentParser</a> argParser(&amp;argc, argv);
  <a name="_a377"></a><a class="code" href="classArSimpleConnector.html">ArSimpleConnector</a> connector(&amp;argParser);
  <a class="code" href="classArGripper.html">ArGripper</a> gripper(&amp;robot);
  <a name="_a378"></a><a class="code" href="classArSonarDevice.html">ArSonarDevice</a> sonar;
  robot.<a name="a379"></a><a class="code" href="classArRobot.html#a8">addRangeDevice</a>(&amp;sonar);

  argParser.loadDefaultArguments();

  <span class="keywordflow">if</span> (!<a name="a380"></a><a class="code" href="classAria.html#e28">Aria::parseArgs</a>() || !argParser.checkHelpAndWarnUnparsed())
  {
    <a name="a381"></a><a class="code" href="classAria.html#e27">Aria::logOptions</a>();
    <a name="a382"></a><a class="code" href="classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> 1;
  }
  
  <span class="keywordflow">if</span> (!connector.connectRobot(&amp;robot))
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a name="a383"></a><a class="code" href="classArLog.html#w2w8">ArLog::Terse</a>, <span class="stringliteral">"gripperExample: Could not connect to robot... exiting"</span>);
    <a class="code" href="classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> 2;
  }
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"gripperExample: Connected to robot."</span>);

  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"gripperExample: GripperType=%d"</span>, gripper.getType());
  gripper.logState();
  <span class="keywordflow">if</span>(gripper.getType() == <a name="a384"></a><a class="code" href="classArGripper.html#w4w2">ArGripper::NOGRIPPER</a>)
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w8">ArLog::Terse</a>, <span class="stringliteral">"gripperExample: Error: Robot does not have a gripper. Exiting."</span>);
    <a class="code" href="classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">// Teleoperation actions with obstacle-collision avoidance</span>
  ArActionLimiterTableSensor tableLimit;
  robot.<a name="a385"></a><a class="code" href="classArRobot.html#a1">addAction</a>(&amp;tableLimit, 110);
  <a name="_a386"></a><a class="code" href="classArActionLimiterForwards.html">ArActionLimiterForwards</a> limitNearAction(<span class="stringliteral">"near"</span>, 300, 600, 250);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;limitNearAction, 100);
  <a class="code" href="classArActionLimiterForwards.html">ArActionLimiterForwards</a> limitFarAction(<span class="stringliteral">"far"</span>, 300, 1100, 400);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;limitFarAction, 90);
  ArActionLimiterBackwards limitBackAction;
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;limitBackAction, 50);
  <a name="_a387"></a><a class="code" href="classArActionJoydrive.html">ArActionJoydrive</a> joydriveAction(<span class="stringliteral">"joydrive"</span>, 400, 15);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;joydriveAction, 40);
  joydriveAction.<a name="a388"></a><a class="code" href="classArActionJoydrive.html#a9">setStopIfNoButtonPressed</a>(<span class="keyword">false</span>);
  ArActionKeydrive keydriveAction;
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;keydriveAction, 30);
  

  <span class="comment">// Handlers to control the gripper and print out info (classes defined above)</span>
  PrintGripStatus printStatus(&amp;gripper);
  GripperControlHandler gripControl(&amp;gripper);
  printStatus.addRobotTask(&amp;robot);
  gripControl.addKeyHandlers(&amp;robot);

  <span class="comment">// enable motors and run (if we lose connection to the robot, exit)</span>
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"You may now operate the robot with arrow keys or joystick. Operate the gripper with the u, d, o, c, and page up/page down keys."</span>);
  robot.enableMotors();
  robot.run(<span class="keyword">true</span>);
  
  <a class="code" href="classAria.html#e37">Aria::shutdown</a>();
  <span class="keywordflow">return</span> 0;
}


</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:38 2010 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
