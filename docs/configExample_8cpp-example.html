<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Aria: configExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>configExample.cpp</h1>Example program demonstrating the use of <a class="el" href="classArConfig.html">ArConfig</a><p>
This program shows how to use <a class="el" href="classArConfig.html">ArConfig</a> to store configuration parameters and load/save them from a file.<p>
The ArNetworking library includes server classes that will let you use a remote client such as MobileEyes to view and change the configuration. See ArNetworking documentation and examples.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="keyword">class </span>ConfigExample
{
  <a name="_a150"></a><a class="code" href="classArConfig.html">ArConfig</a>* myConfig;
  <span class="keywordtype">int</span> myIntParam;
  <span class="keywordtype">double</span> myDoubleParam;
  <span class="keywordtype">bool</span> myBoolParam;
  <span class="keywordtype">char</span> myStringParam[256];
  <a name="_a151"></a><a class="code" href="classArRetFunctorC.html">ArRetFunctorC&lt;bool, ConfigExample&gt;</a> myProcessConfigCB;

<span class="keyword">public</span>:
  ConfigExample():
    myIntParam(0),
    myDoubleParam(0.5),
    myBoolParam(false),
    myProcessConfigCB(this, &amp;ConfigExample::processConfigFile)
  {
    <span class="comment">// The global Aria class contains an ArConfig object.  You can create</span>
    <span class="comment">// other instances of ArConfig, but this is how you can share one ArConfig</span>
    <span class="comment">// among various program modules.</span>
    <span class="comment">// If you want to store a config parameter in ArConfig, first you must add </span>
    <span class="comment">// it to the ArConfig object.  Parameters are stored in sections, and</span>
    <span class="comment">// they affect a variable via a pointer provided in an ArConfigArg</span>
    <span class="comment">// object:</span>
    <a class="code" href="classArConfig.html">ArConfig</a>* config = <a name="a152"></a><a class="code" href="classAria.html#e14">Aria::getConfig</a>();
    config-&gt;<a name="a153"></a><a class="code" href="classArConfig.html#a37">setSectionComment</a>(<span class="stringliteral">"Example Section"</span>, <span class="stringliteral">"Contains parameters created by the configExample"</span>);

    <span class="comment">// Add an integer which ranges from -10 to 10:</span>
    config-&gt;<a name="a154"></a><a class="code" href="classArConfig.html#a1">addParam</a>( <a name="_a155"></a><a class="code" href="classArConfigArg.html">ArConfigArg</a>(<span class="stringliteral">"ExampleIntegerParameter"</span>, &amp;myIntParam, <span class="stringliteral">"Example parameter integer."</span>, -10, 10), <span class="stringliteral">"Example Section"</span>, <a name="a156"></a><a class="code" href="classArPriority.html#w10w9">ArPriority::NORMAL</a>);
    
    <span class="comment">// Add a floating point number which ranges from 0.0 to 1.0:</span>
    config-&gt;<a class="code" href="classArConfig.html#a1">addParam</a>( <a class="code" href="classArConfigArg.html">ArConfigArg</a>(<span class="stringliteral">"ExampleDoubleParameter"</span>, &amp;myDoubleParam, <span class="stringliteral">"Example double precision floating point number."</span>, 0.0, 1.0), <span class="stringliteral">"Example Section"</span>, <a class="code" href="classArPriority.html#w10w9">ArPriority::NORMAL</a>);

    <span class="comment">// Essential parameters can be placed in the "Important" priority level:</span>
    config-&gt;<a class="code" href="classArConfig.html#a1">addParam</a>( <a class="code" href="classArConfigArg.html">ArConfigArg</a>(<span class="stringliteral">"ExampleBoolParameter"</span>, &amp;myBoolParam, <span class="stringliteral">"Example boolean parameter."</span>), <span class="stringliteral">"Example Section"</span>, <a name="a157"></a><a class="code" href="classArPriority.html#w10w6">ArPriority::IMPORTANT</a>);

    <span class="comment">// Unimportant parameters can be placed in the "Trivial" priority level:</span>
    myStringParam[0] = <span class="charliteral">'\0'</span>;  <span class="comment">// make string empty</span>
    config-&gt;<a class="code" href="classArConfig.html#a1">addParam</a>( <a class="code" href="classArConfigArg.html">ArConfigArg</a>(<span class="stringliteral">"ExampleStringParameter"</span>, myStringParam, <span class="stringliteral">"Example string parameter."</span>, 256), <span class="stringliteral">"Example Section"</span>, <a name="a158"></a><a class="code" href="classArPriority.html#w10w12">ArPriority::TRIVIAL</a>);

    <span class="comment">// You can set a callback to be invoked when the configuration changes, in</span>
    <span class="comment">// case you need to respond to any changes in the parameter values:</span>
    config-&gt;<a name="a159"></a><a class="code" href="classArConfig.html#a3">addProcessFileCB</a>(&amp;myProcessConfigCB, 0);
  }

  
  <span class="comment">// Method called by config process callback when a new file is loaded.</span>
  <span class="comment">// It can return false to indicate an error, or true to indicate no error.</span>
  <span class="keywordtype">bool</span> processConfigFile() 
  {
    <a name="a160"></a><a class="code" href="classArLog.html#e4">ArLog::log</a>(<a name="a161"></a><a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"configExample: Config changed. New values: int=%d, float=%f, bool=%s, string=\"%s\"."</span>, myIntParam, myDoubleParam, myBoolParam?<span class="stringliteral">"true"</span>:<span class="stringliteral">"false"</span>, myStringParam);
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
  }
};
  
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a162"></a><a class="code" href="classAria.html#e23">Aria::init</a>();
  <a name="_a163"></a><a class="code" href="classArArgumentParser.html">ArArgumentParser</a> argParser(&amp;argc, argv);
  argParser.loadDefaultArguments();
  <span class="keywordflow">if</span> (argc &lt; 2 || !<a name="a164"></a><a class="code" href="classAria.html#e28">Aria::parseArgs</a>() || argParser.checkArgument(<span class="stringliteral">"-help"</span>))
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a name="a165"></a><a class="code" href="classArLog.html#w2w8">ArLog::Terse</a>, <span class="stringliteral">"configExample usage: configExample &lt;config file&gt;.\nFor example, \"configExample examples/configExample.cfg\"."</span>);
    <a name="a166"></a><a class="code" href="classAria.html#e27">Aria::logOptions</a>();
    <a name="a167"></a><a class="code" href="classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> 1;
  }
  
  <span class="comment">// Object containing config parameters, and responding to changes:</span>
  ConfigExample configExample;

  <span class="comment">// Load a config file given on the command line into the global </span>
  <span class="comment">// ArConfig object kept by Aria.  Normally ArConfig expects config</span>
  <span class="comment">// files to be in the main ARIA directory (i.e. /usr/local/Aria or</span>
  <span class="comment">// a directory specified by the $ARIA environment variable).</span>
  <span class="keywordtype">char</span> error[512];
  <span class="keyword">const</span> <span class="keywordtype">char</span>* filename = argParser.getArg(1);
  <a class="code" href="classArConfig.html">ArConfig</a>* config = <a class="code" href="classAria.html#e14">Aria::getConfig</a>();
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"configExample: loading configuration file \"%s\"..."</span>, filename);
  <span class="keywordflow">if</span> (! config-&gt;<a name="a168"></a><a class="code" href="classArConfig.html#a23">parseFile</a>(filename, <span class="keyword">true</span>, <span class="keyword">false</span>, error, 512) )
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w8">ArLog::Terse</a>, <span class="stringliteral">"configExample: Error loading configuration file \"%s\" %s. Try \"examples/configExample.cfg\"."</span>, filename, error);
    <a class="code" href="classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> -1;
  }

  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"configExample: Loaded configuration file \"%s\"."</span>, filename);
  
  <span class="comment">// After changing a config value, you should invoke the callbacks:</span>
  <a name="_a169"></a><a class="code" href="classArConfigSection.html">ArConfigSection</a>* section = config-&gt;<a name="a170"></a><a class="code" href="classArConfig.html#a12">findSection</a>(<span class="stringliteral">"Example Section"</span>);
  <span class="keywordflow">if</span> (section)
  {
    <a class="code" href="classArConfigArg.html">ArConfigArg</a>* arg = section-&gt;<a name="a171"></a><a class="code" href="classArConfigSection.html#a3">findParam</a>(<span class="stringliteral">"ExampleBoolParameter"</span>);
    <span class="keywordflow">if</span> (arg)
    {
      arg-&gt;setBool(!arg-&gt;getBool());
      <span class="keywordflow">if</span> (! config-&gt;<a name="a172"></a><a class="code" href="classArConfig.html#a8">callProcessFileCallBacks</a>(<span class="keyword">false</span>, error, 512) )
      {
        <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w8">ArLog::Terse</a>, <span class="stringliteral">"configExample: Error processing modified config: %s."</span>, error);
      }
      <span class="keywordflow">else</span>
      {
        <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"configExample: Successfully modified config and invoked callbacks."</span>);
      }
    }
  }

  <span class="comment">// You can save the configuration as well:</span>
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"configExample: Saving configuration..."</span>);
  <span class="keywordflow">if</span>(!config-&gt;<a name="a173"></a><a class="code" href="classArConfig.html#a39">writeFile</a>(filename))
  {
    <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w8">ArLog::Terse</a>, <span class="stringliteral">"configExample: Error saving configuration to file \"%s\"!"</span>, filename);
  }

  <span class="comment">// end of program.</span>
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"configExample: end of program."</span>);
  <a class="code" href="classAria.html#e37">Aria::shutdown</a>();
  <span class="keywordflow">return</span> 0;
}
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:37 2010 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
