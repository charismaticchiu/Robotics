<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Aria: teleopActionsExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>teleopActionsExample.cpp</h1>Example using actions for safe teleoperation with keyboard or joystick.<p>
This example program creates several "limiting" actions (stop the robot from hitting detected obstacles), as well as Joydrive and Keydrive actions which request movement based on keys pressed or a joystick attached to the computer. The limiting actions are added at a higher priority than the teleoperation actions, so they prevent those actions from driving the robot if nearby obstacles are detected; otherwise, you can drive the robot using they joystick or keyboard.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a631"></a><a class="code" href="classAria.html#e23">Aria::init</a>();

  <a name="_a632"></a><a class="code" href="classArRobot.html">ArRobot</a> robot;
  
  <span class="comment">// limiter for close obstacles</span>
  <a name="_a633"></a><a class="code" href="classArActionLimiterForwards.html">ArActionLimiterForwards</a> limiter(<span class="stringliteral">"speed limiter near"</span>, 300, 600, 250);
  <span class="comment">// limiter for far away obstacles</span>
  <a class="code" href="classArActionLimiterForwards.html">ArActionLimiterForwards</a> limiterFar(<span class="stringliteral">"speed limiter far"</span>, 300, 1100, 400);
  <span class="comment">// limiter that checks IR sensors (like Peoplebot has)</span>
  ArActionLimiterTableSensor tableLimiter;
  <span class="comment">// limiter so we don't bump things backwards</span>
  ArActionLimiterBackwards backwardsLimiter;
  <span class="comment">// the joydrive action</span>
  <a name="_a634"></a><a class="code" href="classArActionJoydrive.html">ArActionJoydrive</a> joydriveAct;
  <span class="comment">// the keydrive action</span>
  ArActionKeydrive keydriveAct;
  
  <span class="comment">// sonar device, used by the limiter actions.</span>
  <a name="_a635"></a><a class="code" href="classArSonarDevice.html">ArSonarDevice</a> sonar;

  <a name="_a636"></a><a class="code" href="classArArgumentParser.html">ArArgumentParser</a> parser(&amp;argc, argv);
  parser.loadDefaultArguments();
  <a name="_a637"></a><a class="code" href="classArSimpleConnector.html">ArSimpleConnector</a> connector(&amp;parser);
  
  <span class="keywordflow">if</span> (!<a name="a638"></a><a class="code" href="classAria.html#e28">Aria::parseArgs</a>())
  {
    <a name="a639"></a><a class="code" href="classAria.html#e27">Aria::logOptions</a>();
    <a name="a640"></a><a class="code" href="classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> 1;
  }
  

  printf(<span class="stringliteral">"This program will allow you to use a joystick or keyboard to control the robot.\nYou can use the arrow keys to drive, and the spacebar to stop.\nFor joystick control press the trigger button and then drive.\nPress escape to exit.\n"</span>);

  <span class="comment">// if we don't have a joystick, let 'em know</span>
  <span class="keywordflow">if</span> (!joydriveAct.<a name="a641"></a><a class="code" href="classArActionJoydrive.html#a7">joystickInited</a>())
    printf(<span class="stringliteral">"Do not have a joystick, only the arrow keys on the keyboard will work.\n"</span>);
  
  <span class="comment">// add the sonar to the robot</span>
  robot.<a name="a642"></a><a class="code" href="classArRobot.html#a8">addRangeDevice</a>(&amp;sonar);

  <span class="comment">// try to connect, if we fail exit</span>
  <span class="keywordflow">if</span> (!connector.connectRobot(&amp;robot))
  {
    printf(<span class="stringliteral">"Could not connect to robot... exiting\n"</span>);
    <a class="code" href="classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> 1;
  }

  <span class="comment">// set the robots maximum velocity (sonar don't work at all well if you're</span>
  <span class="comment">// going faster)</span>
  robot.<a name="a643"></a><a class="code" href="classArRobot.html#a264">setAbsoluteMaxTransVel</a>(400);

  <span class="comment">// enable the motor</span>
  robot.<a name="a644"></a><a class="code" href="classArRobot.html#a39">enableMotors</a>();

  <span class="comment">// Add the actions, with the limiters as highest priority, then the teleop.</span>
  <span class="comment">// actions.  This will keep the teleop. actions from being able to drive too </span>
  <span class="comment">// fast and hit something</span>
  robot.<a name="a645"></a><a class="code" href="classArRobot.html#a1">addAction</a>(&amp;tableLimiter, 100);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;limiter, 95);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;limiterFar, 90);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;backwardsLimiter, 85);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;joydriveAct, 50);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;keydriveAct, 45);

  <span class="comment">// Configure the joydrive action so it will let the lower priority actions</span>
  <span class="comment">// (i.e. keydriveAct) request motion if the joystick button is</span>
  <span class="comment">// not pressed.</span>
  joydriveAct.<a name="a646"></a><a class="code" href="classArActionJoydrive.html#a9">setStopIfNoButtonPressed</a>(<span class="keyword">false</span>);

  
  <span class="comment">// run the robot, true means that the run will exit if connection lost</span>
  robot.<a name="a647"></a><a class="code" href="classArRobot.html#a254">run</a>(<span class="keyword">true</span>);
  
  <a class="code" href="classAria.html#e37">Aria::shutdown</a>();
  <span class="keywordflow">return</span> 0;
}
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:38 2010 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
