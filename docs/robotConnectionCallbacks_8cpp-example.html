<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Aria: robotConnectionCallbacks.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>robotConnectionCallbacks.cpp</h1>Demonstrates how callbacks can be registered with <a class="el" href="classArRobot.html">ArRobot</a> to be called when a connection succeeds or fails.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="comment">/*</span>
<span class="comment">  This class contains the methods called by the connection callback functors.</span>
<span class="comment">*/</span>
<span class="keyword">class </span>ConnHandler
{
<span class="keyword">public</span>:
  <span class="comment">// Constructor</span>
  ConnHandler(<a name="_a482"></a><a class="code" href="classArRobot.html">ArRobot</a> *robot);

  <span class="comment">// Destructor, its just empty</span>
  ~ConnHandler(<span class="keywordtype">void</span>) {}
  
  <span class="comment">// called if the connection was sucessfully made</span>
  <span class="keywordtype">void</span> connected(<span class="keywordtype">void</span>);

  <span class="comment">// called if the connection failed. stop the robot processing thread.</span>
  <span class="keywordtype">void</span> connectionFailed(<span class="keywordtype">void</span>);

  <span class="comment">// called when the connection is closed</span>
  <span class="keywordtype">void</span> disconnected(<span class="keywordtype">void</span>);

  <span class="comment">// called if the connection is lost due to an error</span>
  <span class="keywordtype">void</span> connectionLost(<span class="keywordtype">void</span>);

<span class="keyword">protected</span>:
  <span class="comment">// keep a robot pointer</span>
  <a class="code" href="classArRobot.html">ArRobot</a> *myRobot;

  <span class="comment">// the functor callbacks</span>
  <a name="_a483"></a><a class="code" href="classArFunctorC.html">ArFunctorC&lt;ConnHandler&gt;</a> myConnectedCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;ConnHandler&gt;</a> myConnFailCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;ConnHandler&gt;</a> myDisconnectedCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;ConnHandler&gt;</a> myConnLostCB;
};

<span class="comment">/* ConnHandler constructor. Initialize functor objects, then</span>
<span class="comment"> * add them as connection handler callbacks with the robot object.</span>
<span class="comment">*/</span>
ConnHandler::ConnHandler(<a class="code" href="classArRobot.html">ArRobot</a> *robot) :
  myConnectedCB(this, &amp;ConnHandler::connected),  
  myConnFailCB(this, &amp;ConnHandler::connectionFailed),
  myDisconnectedCB(this, &amp;ConnHandler::disconnected),
  myConnLostCB(this, &amp;ConnHandler::connectionLost)

{
  <span class="comment">// keep a robot pointer for use by the handler callback methods</span>
  myRobot = robot;

  <span class="comment">// add the callbacks to the robot</span>
  myRobot-&gt;<a name="a484"></a><a class="code" href="classArRobot.html#a2">addConnectCB</a>(&amp;myConnectedCB, <a name="a485"></a><a class="code" href="classArListPos.html#w2w0">ArListPos::FIRST</a>);
  myRobot-&gt;addFailedConnectCB(&amp;myConnFailCB, <a class="code" href="classArListPos.html#w2w0">ArListPos::FIRST</a>);
  myRobot-&gt;addDisconnectNormallyCB(&amp;myDisconnectedCB, <a class="code" href="classArListPos.html#w2w0">ArListPos::FIRST</a>);
  myRobot-&gt;addDisconnectOnErrorCB(&amp;myDisconnectedCB, <a class="code" href="classArListPos.html#w2w0">ArListPos::FIRST</a>);
}

<span class="comment">// just exit if the connection failed</span>
<span class="keywordtype">void</span> ConnHandler::connectionFailed(<span class="keywordtype">void</span>)
{
  <a name="a486"></a><a class="code" href="classArLog.html#e4">ArLog::log</a>(<a name="a487"></a><a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"ConnHandler: Connection failed. Exiting the program."</span>);
  exit(1);
}

<span class="keywordtype">void</span> ConnHandler::connected(<span class="keywordtype">void</span>)
{
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"ConnHandler: Connected. Turning off sonar,"</span>);
  <span class="comment">// turn off sonar, turn off amigobot sounds</span>
  myRobot-&gt;comInt(<a name="a488"></a><a class="code" href="classArCommands.html#w6w75">ArCommands::SONAR</a>, 0);
  myRobot-&gt;comInt(ArCommands::SOUNDTOG, 0);
}

<span class="comment">// disconnected</span>
<span class="keywordtype">void</span> ConnHandler::disconnected(<span class="keywordtype">void</span>)
{
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"ConnHandler: Connection closed. Exiting the program."</span>);
  exit(0);
}

<span class="comment">// lost connection due to errror, exit</span>
<span class="keywordtype">void</span> ConnHandler::connectionLost(<span class="keywordtype">void</span>)
{
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"ConnHandler: Lost connection due to an error! Exiting the program!"</span>);
  exit(1);
}



<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) 
{
  <a name="a489"></a><a class="code" href="classAria.html#e23">Aria::init</a>();
  <a class="code" href="classArRobot.html">ArRobot</a> robot;
  <a name="_a490"></a><a class="code" href="classArArgumentParser.html">ArArgumentParser</a> argParser(&amp;argc, argv);
  <a name="_a491"></a><a class="code" href="classArSimpleConnector.html">ArSimpleConnector</a> con(&amp;argParser);
  <span class="keywordflow">if</span>(!<a name="a492"></a><a class="code" href="classAria.html#e28">Aria::parseArgs</a>() || !argParser.checkHelpAndWarnUnparsed())
  {
    <a name="a493"></a><a class="code" href="classAria.html#e27">Aria::logOptions</a>();
    <span class="keywordflow">return</span> 1;
  }

  <span class="comment">// Create a connection handler object, defined above, then try to connect to the</span>
  <span class="comment">// robot.</span>
  ConnHandler ch(&amp;robot);
  con.connectRobot(&amp;robot);
  robot.<a name="a494"></a><a class="code" href="classArRobot.html#a255">runAsync</a>(<span class="keyword">true</span>);

  <span class="comment">// Sleep for 10 seconds, then request that ArRobot stop its thread.</span>
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Sleeping for 10 seconds..."</span>);
  <a name="a495"></a><a class="code" href="classArUtil.html#e47">ArUtil::sleep</a>(10000);
  <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"...requesting that the robot thread exit, then shutting down ARIA and exiting."</span>);
  robot.<a name="a496"></a><a class="code" href="classArRobot.html#a327">stopRunning</a>();
  <a name="a497"></a><a class="code" href="classAria.html#e37">Aria::shutdown</a>();
  <span class="keywordflow">return</span> 0;
}

</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:38 2010 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
