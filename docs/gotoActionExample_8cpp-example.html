<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Aria: gotoActionExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>gotoActionExample.cpp</h1>Uses <a class="el" href="classArActionGoto.html">ArActionGoto</a> to drive the robot in a square<p>
This program will make the robot drive in a 2.5x2.5 meter square by setting each corner in turn as the goal for an <a class="el" href="classArActionGoto.html">ArActionGoto</a> action. It also uses speed limiting actions to avoid collisions. After some time, it cancels the goal (and the robot stops due to a stopping action) and exits.<p>
Press escape to shut down <a class="el" href="classAria.html">Aria</a> and exit.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a275"></a><a class="code" href="classAria.html#e23">Aria::init</a>();
  <a name="_a276"></a><a class="code" href="classArArgumentParser.html">ArArgumentParser</a> parser(&amp;argc, argv);
  parser.loadDefaultArguments();
  <a name="_a277"></a><a class="code" href="classArSimpleConnector.html">ArSimpleConnector</a> simpleConnector(&amp;parser);
  <a name="_a278"></a><a class="code" href="classArRobot.html">ArRobot</a> robot;
  <a name="_a279"></a><a class="code" href="classArSonarDevice.html">ArSonarDevice</a> sonar;
  <a name="_a280"></a><a class="code" href="classArAnalogGyro.html">ArAnalogGyro</a> gyro(&amp;robot);
  robot.<a name="a281"></a><a class="code" href="classArRobot.html#a8">addRangeDevice</a>(&amp;sonar);

  <span class="comment">// Make a key handler, so that escape will shut down the program</span>
  <span class="comment">// cleanly</span>
  <a name="_a282"></a><a class="code" href="classArKeyHandler.html">ArKeyHandler</a> keyHandler;
  <a name="a283"></a><a class="code" href="classAria.html#e33">Aria::setKeyHandler</a>(&amp;keyHandler);
  robot.<a name="a284"></a><a class="code" href="classArRobot.html#a20">attachKeyHandler</a>(&amp;keyHandler);
  printf(<span class="stringliteral">"You may press escape to exit\n"</span>);

  <span class="comment">// Collision avoidance actions at higher priority</span>
  <a name="_a285"></a><a class="code" href="classArActionLimiterForwards.html">ArActionLimiterForwards</a> limiterAction(<span class="stringliteral">"speed limiter near"</span>, 300, 600, 250);
  <a class="code" href="classArActionLimiterForwards.html">ArActionLimiterForwards</a> limiterFarAction(<span class="stringliteral">"speed limiter far"</span>, 300, 1100, 400);
  ArActionLimiterTableSensor tableLimiterAction;
  robot.<a name="a286"></a><a class="code" href="classArRobot.html#a1">addAction</a>(&amp;tableLimiterAction, 100);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;limiterAction, 95);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;limiterFarAction, 90);

  <span class="comment">// Goto action at lower priority</span>
  <a name="_a287"></a><a class="code" href="classArActionGoto.html">ArActionGoto</a> gotoPoseAction(<span class="stringliteral">"goto"</span>);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;gotoPoseAction, 50);
  
  <span class="comment">// Stop action at lower priority, so the robot stops if it has no goal</span>
  <a name="_a288"></a><a class="code" href="classArActionStop.html">ArActionStop</a> stopAction(<span class="stringliteral">"stop"</span>);
  robot.<a class="code" href="classArRobot.html#a1">addAction</a>(&amp;stopAction, 40);

  <span class="comment">// Parse all command line arguments</span>
  <span class="keywordflow">if</span> (!<a name="a289"></a><a class="code" href="classAria.html#e28">Aria::parseArgs</a>() || !parser.checkHelpAndWarnUnparsed())
  {    
    <a name="a290"></a><a class="code" href="classAria.html#e27">Aria::logOptions</a>();
    exit(1);
  }
  
  <span class="comment">// Connect to the robot</span>
  <span class="keywordflow">if</span> (!simpleConnector.connectRobot(&amp;robot))
  {
    printf(<span class="stringliteral">"Could not connect to robot... exiting\n"</span>);
    <a name="a291"></a><a class="code" href="classAria.html#e11">Aria::exit</a>(1);
  }
  robot.<a name="a292"></a><a class="code" href="classArRobot.html#a255">runAsync</a>(<span class="keyword">true</span>);

  <span class="comment">// turn on the motors, turn off amigobot sounds</span>
  robot.<a name="a293"></a><a class="code" href="classArRobot.html#a39">enableMotors</a>();
  robot.<a name="a294"></a><a class="code" href="classArRobot.html#a31">comInt</a>(<a name="a295"></a><a class="code" href="classArCommands.html#w6w77">ArCommands::SOUNDTOG</a>, 0);

  <span class="keyword">const</span> <span class="keywordtype">int</span> duration = 30000; <span class="comment">//msec</span>
  <a name="a296"></a><a class="code" href="classArLog.html#e4">ArLog::log</a>(<a name="a297"></a><a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Going to four goals in turn for %d seconds, then cancelling goal and exiting."</span>, duration/1000);

  <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
  <span class="keywordtype">int</span> goalNum = 0;
  <a name="_a298"></a><a class="code" href="classArTime.html">ArTime</a> start;
  start.<a name="a299"></a><a class="code" href="classArTime.html#a16">setToNow</a>();
  <span class="keywordflow">while</span> (<a name="a300"></a><a class="code" href="classAria.html#e22">Aria::getRunning</a>()) 
  {
    robot.<a name="a301"></a><a class="code" href="classArRobot.html#a217">lock</a>();

    <span class="comment">// Choose a new goal if this is the first loop iteration, or if we </span>
    <span class="comment">// achieved the previous goal.</span>
    <span class="keywordflow">if</span> (first || gotoPoseAction.haveAchievedGoal())
    {
      first = <span class="keyword">false</span>;
      goalNum++;
      <span class="keywordflow">if</span> (goalNum &gt; 4)
        goalNum = 1; <span class="comment">// start again at goal #1</span>

      <span class="comment">// set our positions for the different goals</span>
      <span class="keywordflow">if</span> (goalNum == 1)
        gotoPoseAction.setGoal(<a name="_a302"></a><a class="code" href="classArPose.html">ArPose</a>(2500, 0));
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (goalNum == 2)
        gotoPoseAction.setGoal(<a class="code" href="classArPose.html">ArPose</a>(2500, 2500));
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (goalNum == 3)
        gotoPoseAction.setGoal(<a class="code" href="classArPose.html">ArPose</a>(0, 2500));
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (goalNum == 4)
        gotoPoseAction.setGoal(<a class="code" href="classArPose.html">ArPose</a>(0, 0));

      <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Going to next goal at %.0f %.0f"</span>, 
            gotoPoseAction.getGoal().getX(), gotoPoseAction.getGoal().getY());
    }

    <span class="keywordflow">if</span>(start.<a name="a303"></a><a class="code" href="classArTime.html#a9">mSecSince</a>() &gt;= duration) {
      <a class="code" href="classArLog.html#e4">ArLog::log</a>(<a class="code" href="classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"%d seconds have elapsed. Cancelling current goal, waiting 3 seconds, and exiting."</span>, duration/1000);
      gotoPoseAction.cancelGoal();
      robot.<a name="a304"></a><a class="code" href="classArRobot.html#a330">unlock</a>();
      <a name="a305"></a><a class="code" href="classArUtil.html#e47">ArUtil::sleep</a>(3000);
      <span class="keywordflow">break</span>;
    }

    robot.<a class="code" href="classArRobot.html#a330">unlock</a>();
    <a class="code" href="classArUtil.html#e47">ArUtil::sleep</a>(100);
  }
  
  <span class="comment">// Robot disconnected or time elapsed, shut down</span>
  <a name="a306"></a><a class="code" href="classAria.html#e37">Aria::shutdown</a>();
  <span class="keywordflow">return</span> 0;
}
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:38 2010 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
