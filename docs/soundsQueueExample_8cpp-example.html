<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Aria: soundsQueueExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>soundsQueueExample.cpp</h1>This program demonstrates the sound output queue <a class="el" href="classArSoundsQueue.html">ArSoundsQueue</a><p>
Shows how to operate the sounds queue and add WAV files to play.<p>
You may specify up to 10 file names on the command line. This example only demonstrates using the sounds queue for WAV file playback. For demonstration of using the sounds queue for speech synthesis, see the examples provided with either the ArSpeechSynth_Cepstral or ArSpeechSynth_Festival libraries.<p>
Usage: soundQueue <em>&lt;wav file names&gt;</em><p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include "Aria.h"</span>
<span class="preprocessor">#include "ariaTypedefs.h"</span>
<span class="preprocessor">#include "ariaUtil.h"</span>
<span class="preprocessor">#include "ArSoundsQueue.h"</span>
<span class="preprocessor">#include "ArSoundPlayer.h"</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;vector&gt;</span>

<span class="keyword">using</span> <span class="keyword">namespace </span>std;

<span class="keywordtype">void</span> queueNowEmpty() {
  printf(<span class="stringliteral">"The sound queue is now empty.\n"</span>);
}

<span class="keywordtype">void</span> queueNowNonempty() {
  printf(<span class="stringliteral">"The sound queue is now non-empty.\n"</span>);
}

<span class="keywordtype">bool</span> no() {
  <span class="comment">// just a false tautology</span>
  <span class="keywordflow">return</span> <span class="keyword">false</span>;
}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {
  <a name="a603"></a><a class="code" href="classAria.html#e23">Aria::init</a>();
  <span class="comment">//ArLog::init(ArLog::StdErr, ArLog::Verbose);</span>

  <span class="comment">// Create the sound queue.</span>
  <a name="_a604"></a><a class="code" href="classArSoundsQueue.html">ArSoundsQueue</a> soundQueue;

  <span class="comment">// Set WAV file callbacks </span>
  soundQueue.<a name="a605"></a><a class="code" href="classArSoundsQueue.html#a47">setPlayWavFileCallback</a>(<a name="a606"></a><a class="code" href="classArSoundPlayer.html#e0">ArSoundPlayer::getPlayWavFileCallback</a>());
  soundQueue.<a name="a607"></a><a class="code" href="classArSoundsQueue.html#a45">setInterruptWavFileCallback</a>(<a name="a608"></a><a class="code" href="classArSoundPlayer.html#e1">ArSoundPlayer::getStopPlayingCallback</a>());

  <span class="comment">// Notifications when the queue goes empty or non-empty.</span>
  soundQueue.<a name="a609"></a><a class="code" href="classArSoundsQueue.html#a3">addQueueEmptyCallback</a>(<span class="keyword">new</span> <a name="_a610"></a><a class="code" href="classArGlobalFunctor.html">ArGlobalFunctor</a>(&amp;queueNowEmpty));
  soundQueue.<a name="a611"></a><a class="code" href="classArSoundsQueue.html#a4">addQueueNonemptyCallback</a>(<span class="keyword">new</span> <a class="code" href="classArGlobalFunctor.html">ArGlobalFunctor</a>(&amp;queueNowNonempty));

  <span class="comment">// Run the sound queue in a new thread</span>
  soundQueue.<a name="a612"></a><a class="code" href="classArSoundsQueue.html#a40">runAsync</a>();

  <span class="comment">// Get WAV file names from command line</span>
  <span class="keywordflow">if</span>(argc &lt; 2) 
  {
    cerr &lt;&lt; <span class="stringliteral">"Usage: "</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">" &lt;up to ten WAV sound file names...&gt;\n"</span>;
    exit(-1);
  }
  std::vector&lt;const char*&gt; filenames;
  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; min(argc, 11); i++) 
  {
    filenames.push_back(argv[i]);
  }

  <span class="comment">// This functor can be used to cancel all sound playback until removed</span>
  <a name="_a613"></a><a class="code" href="classArGlobalRetFunctor.html">ArGlobalRetFunctor&lt;bool&gt;</a> dontPlayItem(&amp;no);
  
  <span class="keywordflow">while</span>(<a name="a614"></a><a class="code" href="classAria.html#e22">Aria::getRunning</a>())
  {
    cout &lt;&lt; <span class="stringliteral">"Queue is "</span> &lt;&lt; 
      string(soundQueue.<a name="a615"></a><a class="code" href="classArSoundsQueue.html#a19">isPaused</a>()?<span class="stringliteral">"paused"</span>:(soundQueue.<a name="a616"></a><a class="code" href="classArSoundsQueue.html#a20">isPlaying</a>()?<span class="stringliteral">"playing"</span>:<span class="stringliteral">"ready"</span>)) 
      &lt;&lt; <span class="stringliteral">", with "</span> &lt;&lt; soundQueue.<a name="a617"></a><a class="code" href="classArSoundsQueue.html#a14">getCurrentQueueSize</a>() &lt;&lt; <span class="stringliteral">" pending sounds."</span> &lt;&lt; endl
      &lt;&lt; <span class="stringliteral">"Enter a command followed by the enter key:\n"</span>
      &lt;&lt; <span class="stringliteral">"\tp\trequest pause state (cumulative)\n"</span>
      &lt;&lt; <span class="stringliteral">"\tr\trequest resume state (cumulative)\n"</span> 
      &lt;&lt; <span class="stringliteral">"\ti\tinterrupt current sound\n"</span>
      &lt;&lt; <span class="stringliteral">"\tc\tclear the queue\n"</span>
      &lt;&lt; <span class="stringliteral">"\tC\tclear priority &lt; 4 from the queue.\n"</span>
      &lt;&lt; <span class="stringliteral">"\tn\tAdd "</span> &lt;&lt; filenames[0] &lt;&lt; <span class="stringliteral">" to the queue, but with a condition callback to prevent it playing.\n"</span>
      ;
    <span class="keywordflow">for</span>(size_t i = 0; i &lt; filenames.size(); i++)
      cout &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">"\tadd "</span> &lt;&lt; filenames[i] &lt;&lt; <span class="stringliteral">" to the queue\n"</span>;
    cout &lt;&lt; <span class="stringliteral">"\tq\tquit\n\n"</span>;

    <span class="keywordtype">int</span> c = getchar();
    <span class="keywordflow">if</span>(c == <span class="charliteral">'\n'</span>)
      <span class="keywordflow">continue</span>;
    <span class="keywordflow">switch</span>(c)
    {
      <span class="keywordflow">case</span> <span class="charliteral">'p'</span>: soundQueue.<a name="a618"></a><a class="code" href="classArSoundsQueue.html#a26">pause</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'r'</span>: soundQueue.<a name="a619"></a><a class="code" href="classArSoundsQueue.html#a38">resume</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'i'</span>: soundQueue.<a name="a620"></a><a class="code" href="classArSoundsQueue.html#a17">interrupt</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'q'</span>: soundQueue.<a name="a621"></a><a class="code" href="classArSoundsQueue.html#a54">stop</a>(); <a name="a622"></a><a class="code" href="classArUtil.html#e47">ArUtil::sleep</a>(100); exit(0);
      <span class="keywordflow">case</span> <span class="charliteral">'c'</span>: soundQueue.<a name="a623"></a><a class="code" href="classArSoundsQueue.html#a10">clearQueue</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'C'</span>: soundQueue.<a name="a624"></a><a class="code" href="classArSoundsQueue.html#a33">removePendingItems</a>(4); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'n'</span>: 
      {
        cout &lt;&lt; <span class="stringliteral">"Adding \""</span> &lt;&lt; filenames[0] &lt;&lt; <span class="stringliteral">"\" but with a condition callback that will prevent it from playing...\n"</span>;
        <a name="_a625"></a><a class="code" href="classArSoundsQueue_1_1Item.html">ArSoundsQueue::Item</a> item = soundQueue.<a name="a626"></a><a class="code" href="classArSoundsQueue.html#a11">createDefaultFileItem</a>(filenames[0]);
        item.<a name="a627"></a><a class="code" href="classArSoundsQueue_1_1Item.html#o4">playbackConditionCallbacks</a>.push_back(&amp;dontPlayItem);
        soundQueue.<a name="a628"></a><a class="code" href="classArSoundsQueue.html#a2">addItem</a>(item);
        <span class="keywordflow">break</span>;
      }
      <span class="keywordflow">default</span>:
        <span class="keywordflow">if</span>(filenames.size() &gt; 0 &amp;&amp; c &gt;= <span class="charliteral">'0'</span> &amp;&amp; c &lt;= <span class="charliteral">'9'</span>)
        {
          size_t i = c - <span class="charliteral">'0'</span>;
          <span class="keywordflow">if</span>(i &lt; filenames.size()) 
          {
            cout &lt;&lt; <span class="stringliteral">"Adding \""</span> &lt;&lt; filenames[i] &lt;&lt; <span class="stringliteral">"\" to the queue...\n"</span>; 
            soundQueue.<a name="a629"></a><a class="code" href="classArSoundsQueue.html#a27">play</a>(filenames[i]);
          } 
        }
    }
  }
  cout &lt;&lt; <span class="stringliteral">"Aria ended.\n"</span>;
  <a name="a630"></a><a class="code" href="classAria.html#e37">Aria::shutdown</a>();
  <span class="keywordflow">return</span> 0;
}


</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:38 2010 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
