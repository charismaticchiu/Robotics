<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ArNetworking: ptzCameraClientExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>ptzCameraClientExample.cpp</h1>Example client showing how to control a Pan/Tilt/Zoom camera remotely.<p>
To use, first run SAVserver. Then run serverDemo, or guiServer from ARNL or guiServerSonar from SONARNL on the robot's onboard computer. Or run your own server program that includes <a class="el" href="classArServerHandlerCamera.html">ArServerHandlerCamera</a>. Then from another host, run ptzCameraClientExample with the -host argument. For example, if the hostname of the robot's onboard computer is "robot", run: ptzCameraClientExample -host robot<p>
This program connects to the server, gets a list of cameras if neccesary, and for each camera on the robot, it receives and prints out one information packet, then a continuous stream of data packets, and then sends requests to cycle through each of its pan and tilt limits.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>
<span class="preprocessor">#include "<a class="code" href="ArNetworking_8h.html">ArNetworking.h</a>"</span>
<span class="preprocessor">#include &lt;math.h&gt;</span>


<span class="keyword">class </span><a name="_a121"></a><a class="code" href="classArNetCameraRequest.html">ArNetCameraRequest</a> : <span class="keyword">public</span> <a name="_a122"></a><a class="code" href="classArNetPacket.html">ArNetPacket</a>
{
  <a name="_a123"></a><a class="code" href="classArClientBase.html">ArClientBase</a> *myClient;
  std::string myAbsReqName;
<span class="keyword">public</span>:
  <a class="code" href="classArNetCameraRequest.html">ArNetCameraRequest</a>(<a class="code" href="classArClientBase.html">ArClientBase</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *cameraName = <span class="stringliteral">""</span>) : myClient(client), myAbsReqName(std::string(<span class="stringliteral">"setCameraAbs"</span>)+cameraName)
  {}
  <span class="keywordtype">void</span> setCameraName(<span class="keyword">const</span> <span class="keywordtype">char</span> *name) {
    myAbsReqName = std::string(<span class="stringliteral">"setCameraAbs"</span>) + name;
  }
  <span class="keywordtype">bool</span> requestPanTiltZoomAbs(<span class="keywordtype">double</span> pan, <span class="keywordtype">double</span> tilt, <span class="keywordtype">double</span> zoom);
  <span class="keywordtype">bool</span> requestPanTiltAbs(<span class="keywordtype">double</span> pan, <span class="keywordtype">double</span> tilt);
};


<span class="keyword">class </span><a name="_a124"></a><a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a> {
<span class="keyword">public</span>:
  std::string name;
  std::string type;
  std::string displayName;
  std::string displayType;
  <span class="keywordtype">double</span> minPan, maxPan, minTilt, maxTilt, minZoom, maxZoom;
  <span class="keywordtype">bool</span> haveZoom;
  <span class="keywordtype">double</span> pan, tilt, zoom;

  <span class="keywordtype">void</span> handleCameraInfoReply(<a class="code" href="classArNetPacket.html">ArNetPacket</a> *packet);
  <span class="keywordtype">void</span> handleCameraDataReply(<a class="code" href="classArNetPacket.html">ArNetPacket</a> *packet);

  <a class="code" href="classArClientBase.html">ArClientBase</a> *myClient;
  <a class="code" href="classArNetCameraRequest.html">ArNetCameraRequest</a> request;
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html">ArMutex</a> myMutex;

  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArFunctor1C.html">ArFunctor1C&lt;ArClientHandlerCamera, ArNetPacket*&gt;</a> myCameraInfoReplyFunc;
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArFunctor1C.html">ArFunctor1C&lt;ArClientHandlerCamera, ArNetPacket*&gt;</a> myCameraDataReplyFunc;

  <a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a>(<a class="code" href="classArClientBase.html">ArClientBase</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *cameraName) : 
    name(cameraName), myClient(client), request(client, cameraName) ,
    myCameraInfoReplyFunc(this, &amp;<a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a>::handleCameraInfoReply),
    myCameraDataReplyFunc(this, &amp;<a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a>::handleCameraDataReply)
  {
    myClient-&gt;addHandler((std::string(<span class="stringliteral">"getCameraInfo"</span>)+name).c_str(), &amp;myCameraInfoReplyFunc);
    myClient-&gt;addHandler((std::string(<span class="stringliteral">"getCameraData"</span>)+name).c_str(), &amp;myCameraDataReplyFunc);
  }

  <span class="keywordtype">void</span> requestUpdates(<span class="keywordtype">int</span> dataRequestFreq) {
    myClient-&gt;request((std::string(<span class="stringliteral">"getCameraInfo"</span>)+name).c_str(), -1);
    myClient-&gt;request((std::string(<span class="stringliteral">"getCameraData"</span>)+name).c_str(), 100);
  }

  <span class="keywordtype">void</span> lock() { myMutex.lock(); }
  <span class="keywordtype">void</span> unlock() { myMutex.unlock(); }
};


<span class="keyword">class </span><a name="_a125"></a><a class="code" href="classPtzCameraExample.html">PtzCameraExample</a>
{
  <a class="code" href="classArClientBase.html">ArClientBase</a> *myClient;

  std::set&lt;ArClientHandlerCamera*&gt; myCameras;
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html">ArMutex</a> mutex;

  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArFunctor1C.html">ArFunctor1C&lt;PtzCameraExample, ArNetPacket*&gt;</a> myCameraListReplyFunc;

  <span class="keywordtype">void</span> handleCameraListReply(<a class="code" href="classArNetPacket.html">ArNetPacket</a> *packet);


<span class="keyword">public</span>:
  <a class="code" href="classPtzCameraExample.html">PtzCameraExample</a>(<a class="code" href="classArClientBase.html">ArClientBase</a> *client) : 
    myClient(client), 
    myCameraListReplyFunc(this, &amp;<a class="code" href="classPtzCameraExample.html">PtzCameraExample</a>::handleCameraListReply)
  {
  }

  <span class="keywordtype">bool</span> init();
  <span class="keywordtype">void</span> run();
};



<span class="keywordtype">int</span> <a name="a126"></a><a class="code" href="clientCommandLister_8cpp.html#a0">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a127"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e23">Aria::init</a>();
  <a class="code" href="classArClientBase.html">ArClientBase</a> client;

  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentParser.html">ArArgumentParser</a> parser(&amp;argc, argv);
  <a name="_a128"></a><a class="code" href="classArClientSimpleConnector.html">ArClientSimpleConnector</a> clientConnector(&amp;parser);
  parser.loadDefaultArguments();
  <span class="keywordflow">if</span> (!<a name="a129"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e28">Aria::parseArgs</a>() || !parser.checkHelpAndWarnUnparsed())
  {    
    <a name="a130"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e27">Aria::logOptions</a>();
    <span class="keywordflow">return</span> 1;
  }

  <span class="keywordflow">if</span> (!clientConnector.connectClient(&amp;client))
  {
    <span class="keywordflow">if</span>(client.<a name="a131"></a><a class="code" href="classArClientBase.html#a69">wasRejected</a>())
      <a name="a132"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a name="a133"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w8">ArLog::Terse</a>, <span class="stringliteral">"Error, server '%s' rejected connection. Exiting."</span>, client.<a name="a134"></a><a class="code" href="classArClientBase.html#a15">getHost</a>());
    <span class="keywordflow">else</span>
      <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(ArLog::Terse, <span class="stringliteral">"Error, could not connect to server '%s'. Exiting."</span>, client.<a class="code" href="classArClientBase.html#a15">getHost</a>());
    <span class="keywordflow">return</span> 2;
  }

  client.<a name="a135"></a><a class="code" href="classArClientBase.html#a63">setRobotName</a>(client.<a class="code" href="classArClientBase.html#a15">getHost</a>());  <span class="comment">// include server hostname in log messages</span>

  client.<a name="a136"></a><a class="code" href="classArClientBase.html#a57">runAsync</a>();

  <a class="code" href="classPtzCameraExample.html">PtzCameraExample</a> example(&amp;client);
  <span class="keywordflow">if</span>(!example.init())
    <span class="keywordflow">return</span> 1;

  example.run();


  <a name="a137"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e37">Aria::shutdown</a>();
  <span class="keywordflow">return</span> 0;
}


<span class="keywordtype">bool</span> <a name="a138"></a><a class="code" href="classPtzCameraExample.html#a0">PtzCameraExample::init</a>()
{
  <span class="comment">// If the server has the "getCameraList" request, then it's using</span>
  <span class="comment">// ArServerHandlerCameraCollection, and migth have multiple PTZs/cameras each with</span>
  <span class="comment">// its own set of requests. So send a "getCameraList" request, and when its</span>
  <span class="comment">// reply is received, the handler will send "getCameraInfo" requests for each.</span>
  <span class="comment">// If the server does not have "getCameraList", it only has one PTZ camera, just</span>
  <span class="comment">// send "getCameraInfo". The handler for that will send various control</span>
  <span class="comment">// commands.</span>
  <span class="comment">// If the server does not have "getCameraInfo", then it doesn't provide any</span>
  <span class="comment">// access to PTZ cameras.</span>
  <span class="keywordflow">if</span>(myClient-&gt;<a name="a139"></a><a class="code" href="classArClientBase.html#a6">dataExists</a>(<span class="stringliteral">"getCameraList"</span>))
  {
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a name="a140"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Server may have multiple cameras. Requesting list."</span>);
    myClient-&gt;<a name="a141"></a><a class="code" href="classArClientBase.html#a2">addHandler</a>(<span class="stringliteral">"getCameraList"</span>, &amp;myCameraListReplyFunc);
    myClient-&gt;<a name="a142"></a><a class="code" href="classArClientBase.html#a48">requestOnce</a>(<span class="stringliteral">"getCameraList"</span>);
  }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(myClient-&gt;<a class="code" href="classArClientBase.html#a6">dataExists</a>(<span class="stringliteral">"getCameraInfo"</span>))
  {
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Server does not support multiple cameras. Requesting info for its camera."</span>);
    <a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a> *camClient = <span class="keyword">new</span> <a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a>(myClient, <span class="stringliteral">""</span>);
    camClient-&gt;<a name="a143"></a><a class="code" href="classArClientHandlerCamera.html#a4">requestUpdates</a>(100);
    mutex.<a name="a144"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html#a4">lock</a>();
    myCameras.insert(camClient);
    mutex.<a name="a145"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html#a9">unlock</a>();
  }
  <span class="keywordflow">else</span>
  {
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(ArLog::Terse, <span class="stringliteral">"Error, server does not have any camera control requests. (Was the server run with video features enabled or video forwarding active?)"</span>);
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
  }
  <span class="keywordflow">return</span> <span class="keyword">true</span>;
}

<span class="keywordtype">void</span> PtzCameraExample::handleCameraListReply(<a class="code" href="classArNetPacket.html">ArNetPacket</a> *pkt)
{
  <a name="a146"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a> numCams = pkt-&gt;<a name="a147"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a3">bufToByte2</a>();
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"%d cameras in list."</span>, numCams);
  <span class="keywordtype">char</span> camName[128];
  <span class="keywordtype">char</span> camType[128];
  <span class="keywordtype">char</span> displayName[128];
  <span class="keywordtype">char</span> displayType[128];
  <span class="keywordtype">char</span> cmdDesc[128];
  <span class="keywordtype">char</span> cmdName[128];
  <a name="a148"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w2">ArTypes::Byte4</a> cmdFreq;
  <span class="keywordtype">int</span> dataReqFreq = 100;
  <span class="keywordflow">for</span>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a> i = 0; i &lt; numCams; ++i)
  {
    memset(camName, 0, 128);
    memset(camType, 0, 128);
    memset(displayName, 0, 128);
    memset(displayType, 0, 128);
    pkt-&gt;<a name="a149"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a7">bufToStr</a>(camName, 128); <span class="comment">// name</span>

    <a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a> *cam = <span class="keyword">new</span> <a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a>(myClient, camName);

    pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a7">bufToStr</a>(camType, 128); <span class="comment">// type</span>
    cam-&gt;<a name="a150"></a><a class="code" href="classArClientHandlerCamera.html#o17">type</a> = camType;
    pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a7">bufToStr</a>(displayName, 128); <span class="comment">// description</span>
    cam-&gt;<a name="a151"></a><a class="code" href="classArClientHandlerCamera.html#o0">displayName</a> = displayName;
    pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a7">bufToStr</a>(displayType, 128); <span class="comment">// description</span>
    cam-&gt;<a name="a152"></a><a class="code" href="classArClientHandlerCamera.html#o1">displayType</a> = displayType;
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a> numCmds = pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a3">bufToByte2</a>();
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"%d commands for camera \'%s\' (%s) / \'%s\' (%s)"</span>, numCmds, camName, camType, displayName, displayType);
    <span class="keywordflow">for</span>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a> c = 0; c &lt; numCmds; ++c)
    {
      memset(cmdDesc, 0, 128);
      memset(cmdName, 0, 128);
      <span class="keywordtype">char</span> cmdDesc[128];
      <span class="keywordtype">char</span> cmdName[128];
      pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a7">bufToStr</a>(cmdDesc, 128); <span class="comment">// description</span>
      pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a7">bufToStr</a>(cmdName, 128); <span class="comment">// request name</span>
      cmdFreq = pkt-&gt;<a name="a153"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a4">bufToByte4</a>(); <span class="comment">// recommended request frequency</span>
      <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Camera %s has %s command named %s with recommended request frequency %d."</span>, camName, cmdDesc, cmdName, cmdFreq);

      <span class="keywordflow">if</span>(strcmp(cmdDesc, <span class="stringliteral">"getCameraData"</span>) == 0)
        dataReqFreq = cmdFreq;
    }
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a> numParams = pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a3">bufToByte2</a>();
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Camera %s has %d parameters."</span>, camName, numParams);
    <span class="keywordflow">for</span>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a> p = 0; p &lt; numParams; ++p)
    {
      <a name="_a154"></a><a class="code" href="classArClientArg.html">ArClientArg</a> carg;
      <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArConfigArg.html">ArConfigArg</a> arg;
      <span class="keywordflow">if</span>(!carg.<a name="a155"></a><a class="code" href="classArClientArg.html#a3">bufToArgValue</a>(pkt, arg))
        <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Hmm, error getting ArClientArg for camera %s's parameter #%d."</span>, camName, p);
    }

    cam-&gt;<a class="code" href="classArClientHandlerCamera.html#a4">requestUpdates</a>(dataReqFreq);
    mutex.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html#a4">lock</a>();
    myCameras.insert(cam);
    mutex.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html#a9">unlock</a>();
  }
}

<span class="keywordtype">void</span> <a name="a156"></a><a class="code" href="classArClientHandlerCamera.html#a2">ArClientHandlerCamera::handleCameraInfoReply</a>(<a class="code" href="classArNetPacket.html">ArNetPacket</a> *pkt)
{
  <a name="a157"></a><a class="code" href="classArClientHandlerCamera.html#a3">lock</a>();
  <a name="a158"></a><a class="code" href="classArClientHandlerCamera.html#o6">minPan</a> = pkt-&gt;bufToByte2() / 1000.0;
  <a name="a159"></a><a class="code" href="classArClientHandlerCamera.html#o3">maxPan</a> = pkt-&gt;bufToByte2() / 1000.0;
  <a name="a160"></a><a class="code" href="classArClientHandlerCamera.html#o7">minTilt</a> = pkt-&gt;bufToByte2() / 1000.0;
  <a name="a161"></a><a class="code" href="classArClientHandlerCamera.html#o4">maxTilt</a> = pkt-&gt;bufToByte2() / 1000.0;
  <a name="a162"></a><a class="code" href="classArClientHandlerCamera.html#o8">minZoom</a> = pkt-&gt;bufToByte2() / 1000.0;
  <a name="a163"></a><a class="code" href="classArClientHandlerCamera.html#o5">maxZoom</a> = pkt-&gt;bufToByte2() / 1000.0;
  <a name="a164"></a><a class="code" href="classArClientHandlerCamera.html#o2">haveZoom</a> = pkt-&gt;bufToByte();
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Got getCameraInfo reply with pan range (%f, %f), tilt range (%f, %f), zoom range (%f, %f), zoom valid %d."</span>, <a class="code" href="classArClientHandlerCamera.html#o6">minPan</a>, <a class="code" href="classArClientHandlerCamera.html#o3">maxPan</a>, <a class="code" href="classArClientHandlerCamera.html#o7">minTilt</a>, <a class="code" href="classArClientHandlerCamera.html#o4">maxTilt</a>, <a class="code" href="classArClientHandlerCamera.html#o8">minZoom</a>, <a class="code" href="classArClientHandlerCamera.html#o5">maxZoom</a>, <a class="code" href="classArClientHandlerCamera.html#o2">haveZoom</a>);
  <a name="a165"></a><a class="code" href="classArClientHandlerCamera.html#a5">unlock</a>();
}

<span class="keywordtype">void</span> <a name="a166"></a><a class="code" href="classArClientHandlerCamera.html#a1">ArClientHandlerCamera::handleCameraDataReply</a>(<a class="code" href="classArNetPacket.html">ArNetPacket</a> *pkt)
{
  <a class="code" href="classArClientHandlerCamera.html#a3">lock</a>();
  <a name="a167"></a><a class="code" href="classArClientHandlerCamera.html#o14">pan</a> = pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a3">bufToByte2</a>() / 1000.0;
  <a name="a168"></a><a class="code" href="classArClientHandlerCamera.html#o16">tilt</a> = pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a3">bufToByte2</a>() / 1000.0;
  <a name="a169"></a><a class="code" href="classArClientHandlerCamera.html#o18">zoom</a> = pkt-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a3">bufToByte2</a>() /1000.0;
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Got camera data from camera %s with current pan=%f, tilt=%f, zoom=%f."</span>, <a name="a170"></a><a class="code" href="classArClientHandlerCamera.html#o13">name</a>.c_str(), <a class="code" href="classArClientHandlerCamera.html#o14">pan</a>, <a class="code" href="classArClientHandlerCamera.html#o16">tilt</a>, <a class="code" href="classArClientHandlerCamera.html#o18">zoom</a>);
  <a class="code" href="classArClientHandlerCamera.html#a5">unlock</a>();
}

<span class="keywordtype">bool</span> <a name="a171"></a><a class="code" href="classArNetCameraRequest.html#a1">ArNetCameraRequest::requestPanTiltAbs</a>(<span class="keywordtype">double</span> pan, <span class="keywordtype">double</span> tilt)
{
  <a name="a172"></a><a class="code" href="classArNetPacket.html#a6">empty</a>();
  <a name="a173"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a11">byte2ToBuf</a>((<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a>)(pan * 1000.0));
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a11">byte2ToBuf</a>((<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a>)(tilt * 1000.0));
  <a name="a174"></a><a class="code" href="classArNetPacket.html#a7">finalizePacket</a>();
  <span class="keywordflow">return</span> myClient-&gt;<a class="code" href="classArClientBase.html#a48">requestOnce</a>(myAbsReqName.c_str(), <span class="keyword">this</span>);
}

<span class="keywordtype">bool</span> <a name="a175"></a><a class="code" href="classArNetCameraRequest.html#a2">ArNetCameraRequest::requestPanTiltZoomAbs</a>(<span class="keywordtype">double</span> pan, <span class="keywordtype">double</span> tilt, <span class="keywordtype">double</span> zoom)
{
  <a class="code" href="classArNetPacket.html#a6">empty</a>();
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a11">byte2ToBuf</a>((<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a>)(pan * 1000.0));
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a11">byte2ToBuf</a>((<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a>)(tilt * 1000.0));
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a11">byte2ToBuf</a>((<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArTypes.html#w1">ArTypes::Byte2</a>)(zoom * 1000.0));
  <a class="code" href="classArNetPacket.html#a7">finalizePacket</a>();
  <span class="keywordflow">return</span> myClient-&gt;<a class="code" href="classArClientBase.html#a48">requestOnce</a>(myAbsReqName.c_str(), <span class="keyword">this</span>);
}


<span class="keywordtype">void</span> <a name="a176"></a><a class="code" href="classPtzCameraExample.html#a2">PtzCameraExample::run</a>()
{
  <span class="keyword">enum</span> { MinPan, MaxPan, Center1, MinTilt, MaxTilt, Center2} stage;
  stage = MinPan;
  <span class="keywordflow">while</span>(myClient-&gt;<a name="a177"></a><a class="code" href="classArClientBase.html#a33">isConnected</a>()) 
  {
    mutex.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html#a4">lock</a>();
    <span class="keywordflow">for</span>(std::set&lt;ArClientHandlerCamera*&gt;::const_iterator i = myCameras.begin(); i != myCameras.end(); ++i)
    {
      <a class="code" href="classArClientHandlerCamera.html">ArClientHandlerCamera</a>* c = (*i);
      c-&gt;<a class="code" href="classArClientHandlerCamera.html#a3">lock</a>();
      <span class="keywordflow">switch</span>(stage)
      {
        <span class="keywordflow">case</span> MinPan:
          c-&gt;<a name="a178"></a><a class="code" href="classArClientHandlerCamera.html#o15">request</a>.<a class="code" href="classArNetCameraRequest.html#a1">requestPanTiltAbs</a>(c-&gt;<a class="code" href="classArClientHandlerCamera.html#o6">minPan</a>, 0);
          stage = MaxPan;
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> MaxPan:
          c-&gt;<a class="code" href="classArClientHandlerCamera.html#o15">request</a>.<a class="code" href="classArNetCameraRequest.html#a1">requestPanTiltAbs</a>(c-&gt;<a class="code" href="classArClientHandlerCamera.html#o3">maxPan</a>, 0);
          stage = Center1;
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> Center1:
          c-&gt;<a class="code" href="classArClientHandlerCamera.html#o15">request</a>.<a class="code" href="classArNetCameraRequest.html#a1">requestPanTiltAbs</a>(0, 0);
          stage = MinTilt;
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> MinTilt:
          c-&gt;<a class="code" href="classArClientHandlerCamera.html#o15">request</a>.<a class="code" href="classArNetCameraRequest.html#a1">requestPanTiltAbs</a>(0, c-&gt;<a class="code" href="classArClientHandlerCamera.html#o7">minTilt</a>);
          stage = MaxTilt;
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> MaxTilt:
          c-&gt;<a class="code" href="classArClientHandlerCamera.html#o15">request</a>.<a class="code" href="classArNetCameraRequest.html#a1">requestPanTiltAbs</a>(0, c-&gt;<a class="code" href="classArClientHandlerCamera.html#o4">maxTilt</a>);
          stage = Center2;
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> Center2:
          c-&gt;<a class="code" href="classArClientHandlerCamera.html#o15">request</a>.<a class="code" href="classArNetCameraRequest.html#a1">requestPanTiltAbs</a>(0, 0);
          stage = MinPan;
      }
      c-&gt;<a class="code" href="classArClientHandlerCamera.html#a5">unlock</a>();
    }
    mutex.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArMutex.html#a9">unlock</a>();
    <a name="a179"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArUtil.html#e47">ArUtil::sleep</a>(3000);
  }
}
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:55 2010 for ArNetworking by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
