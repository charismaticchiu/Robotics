<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ArNetworking: drawingsExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>drawingsExample.cpp</h1>Example showing how to draw custom graphics in clients such as MobileEyes<p>
This is an example server that shows how to draw arbitrary figures in a client (e.g. MobileEyes) via <a class="el" href="classArServerInfoDrawings.html">ArServerInfoDrawings</a>. It draws some lines, "arrows", and moving dots with various sizes and colors. You can use these drawings for debugging or visualization, for example, to represent sensor readings. In fact, specific support for <a class="elRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html">ArRobot</a>, ArSick, <a class="elRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArSonarDevice.html">ArSonarDevice</a>, <a class="elRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArIRs.html">ArIRs</a> and <a class="elRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBumpers.html">ArBumpers</a> are built in to <a class="el" href="classArServerInfoDrawings.html">ArServerInfoDrawings</a>: see <a class="el" href="drawingsExampleWithRobot_8cpp.html">drawingsExampleWithRobot.cpp</a> or <a class="el" href="serverDemo_8cpp.html">serverDemo.cpp</a>.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="drawingsExampleWithRobot_8cpp.html">drawingsExampleWithRobot.cpp</a></dd></dl>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>
<span class="preprocessor">#include "<a class="code" href="ArNetworking_8h.html">ArNetworking.h</a>"</span>
<span class="preprocessor">#include &lt;math.h&gt;</span>


<span class="comment">/* These are callbacks that respond to client requests for the drawings' </span>
<span class="comment"> * geometry data. */</span>
<span class="keywordtype">void</span> <a name="a0"></a><a class="code" href="drawingsExample_8cpp.html#a0">exampleHomeDrawingNetCallback</a>(<a name="_a1"></a><a class="code" href="classArServerClient.html">ArServerClient</a>* <a name="a2"></a><a class="code" href="configClient_8cpp.html#a0">client</a>, <a name="_a3"></a><a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt);
<span class="keywordtype">void</span> <a name="a4"></a><a class="code" href="drawingsExample_8cpp.html#a1">exampleDotsDrawingNetCallback</a>(<a class="code" href="classArServerClient.html">ArServerClient</a>* <a class="code" href="configClient_8cpp.html#a0">client</a>, <a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt);
<span class="keywordtype">void</span> <a name="a5"></a><a class="code" href="drawingsExample_8cpp.html#a2">exampleXDrawingNetCallback</a>(<a class="code" href="classArServerClient.html">ArServerClient</a>* <a class="code" href="configClient_8cpp.html#a0">client</a>, <a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt);
<span class="keywordtype">void</span> <a name="a6"></a><a class="code" href="drawingsExample_8cpp.html#a3">exampleArrowsDrawingNetCallback</a>(<a class="code" href="classArServerClient.html">ArServerClient</a>* <a class="code" href="configClient_8cpp.html#a0">client</a>, <a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt);

<span class="keywordtype">int</span> <a name="a7"></a><a class="code" href="clientCommandLister_8cpp.html#a0">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a8"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e23">Aria::init</a>();
  <a name="_a9"></a><a class="code" href="classArServerBase.html">ArServerBase</a> server;

  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentParser.html">ArArgumentParser</a> parser(&amp;argc, argv);
  <a name="_a10"></a><a class="code" href="classArServerSimpleOpener.html">ArServerSimpleOpener</a> simpleOpener(&amp;parser);

  <span class="comment">// parse the command line... fail and print the help if the parsing fails</span>
  <span class="comment">// or if help was requested</span>
  parser.loadDefaultArguments();
  <span class="keywordflow">if</span> (!simpleOpener.parseArgs() || !parser.checkHelpAndWarnUnparsed())
  {    
    simpleOpener.logOptions();
    exit(1);
  }


  <span class="comment">// first open the server up</span>
  <span class="keywordflow">if</span> (!simpleOpener.open(&amp;server))
  {
    <span class="keywordflow">if</span> (simpleOpener.wasUserFileBad())
      printf(<span class="stringliteral">"Error: Bad user/password/permissions file.\n"</span>);
    <span class="keywordflow">else</span>
      printf(<span class="stringliteral">"Error: Could not open server port. Use -help to see options.\n"</span>);
    exit(1);
  }


  <span class="comment">// This is the service that provides drawing data to the client.</span>
  <a name="_a11"></a><a class="code" href="classArServerInfoDrawings.html">ArServerInfoDrawings</a> drawings(&amp;server);

  <span class="comment">// Add our custom drawings</span>
  drawings.addDrawing(
      <span class="comment">//                shape:      color:               size:   layer:</span>
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArDrawingData.html">ArDrawingData</a>(<span class="stringliteral">"polyLine"</span>, <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArColor.html">ArColor</a>(255, 0, 0),  2,      49),
      <span class="stringliteral">"exampleDrawing_Home"</span>, 
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArGlobalFunctor2.html">ArGlobalFunctor2&lt;ArServerClient*, ArNetPacket*&gt;</a>(&amp;<a class="code" href="drawingsExample_8cpp.html#a0">exampleHomeDrawingNetCallback</a>)
  );
  drawings.addDrawing(                                    
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArDrawingData.html">ArDrawingData</a>(<span class="stringliteral">"polyDots"</span>, <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArColor.html">ArColor</a>(0, 255, 0), 250, 48),
      <span class="stringliteral">"exampleDrawing_Dots"</span>, 
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArGlobalFunctor2.html">ArGlobalFunctor2&lt;ArServerClient*, ArNetPacket*&gt;</a>(&amp;<a class="code" href="drawingsExample_8cpp.html#a1">exampleDotsDrawingNetCallback</a>)
  );
  drawings.addDrawing(
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArDrawingData.html">ArDrawingData</a>(<span class="stringliteral">"polySegments"</span>, <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArColor.html">ArColor</a>(0, 0, 0), 4, 52),
      <span class="stringliteral">"exampleDrawing_XMarksTheSpot"</span>, 
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArGlobalFunctor2.html">ArGlobalFunctor2&lt;ArServerClient*, ArNetPacket*&gt;</a>(&amp;<a class="code" href="drawingsExample_8cpp.html#a2">exampleXDrawingNetCallback</a>)
  );
  drawings.addDrawing(
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArDrawingData.html">ArDrawingData</a>(<span class="stringliteral">"polyArrows"</span>, <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArColor.html">ArColor</a>(255, 0, 255), 500, 100),
      <span class="stringliteral">"exampleDrawing_Arrows"</span>, 
      <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArGlobalFunctor2.html">ArGlobalFunctor2&lt;ArServerClient*, ArNetPacket*&gt;</a>(&amp;<a class="code" href="drawingsExample_8cpp.html#a3">exampleArrowsDrawingNetCallback</a>)
  );


  <span class="comment">// log whatever we wanted to before the runAsync</span>
  simpleOpener.checkAndLog();

  <span class="comment">// run the server thread in the background</span>
  server.<a name="a12"></a><a class="code" href="classArServerBase.html#a51">runAsync</a>();

  printf(<span class="stringliteral">"Server is now running...\n"</span>);


  <span class="comment">// Add a key handler mostly that windows can exit by pressing</span>
  <span class="comment">// escape, note that the key handler prevents you from running this program</span>
  <span class="comment">// in the background on Linux.</span>
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArKeyHandler.html">ArKeyHandler</a> *keyHandler;
  <span class="keywordflow">if</span> ((keyHandler = <a name="a13"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e18">Aria::getKeyHandler</a>()) == NULL)
  {
    keyHandler = <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArKeyHandler.html">ArKeyHandler</a>;
    <a name="a14"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e33">Aria::setKeyHandler</a>(keyHandler);
    printf(<span class="stringliteral">"To exit, press escape.\n"</span>);
  }

 
  <span class="comment">// run forever</span>
  <span class="keywordflow">while</span>(<span class="keyword">true</span>) <a name="a15"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArUtil.html#e47">ArUtil::sleep</a>(10000);

  <a name="a16"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e37">Aria::shutdown</a>();
  exit(0);  
}




<span class="comment">// Network callbacks for drawings' current geometry data:</span>

<span class="keywordtype">void</span> <a class="code" href="drawingsExample_8cpp.html#a0">exampleHomeDrawingNetCallback</a>(<a class="code" href="classArServerClient.html">ArServerClient</a>* <a class="code" href="configClient_8cpp.html#a0">client</a>, <a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt) {
  <a class="code" href="classArNetPacket.html">ArNetPacket</a> reply;

  <span class="comment">// 7 Vertices</span>
  reply.<a name="a17"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(7);

  <span class="comment">// Centered on 0,0.</span>
  <span class="comment">// X:                    Y:</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-500);  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(500);   <span class="comment">// Vertex 1</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-500);  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-500);  <span class="comment">// Vertex 2</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(500);   reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-500);  <span class="comment">// Vertex 3</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(500);   reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(500);   <span class="comment">// Vertex 4</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(0);     reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(1000);  <span class="comment">// Vertex 5</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-500);  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(500);   <span class="comment">// Vertex 6</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(500);   reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(500);   <span class="comment">// Vertex 7</span>

  client-&gt;<a name="a18"></a><a class="code" href="classArServerClient.html#a24">sendPacketUdp</a>(&amp;reply);
}

<span class="keywordtype">void</span> <a class="code" href="drawingsExample_8cpp.html#a1">exampleDotsDrawingNetCallback</a>(<a class="code" href="classArServerClient.html">ArServerClient</a>* client, <a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt) {
  <a class="code" href="classArNetPacket.html">ArNetPacket</a> reply;

  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tik = <a name="a19"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArUtil.html#e27">ArUtil::getTime</a>() % 200;
  <span class="keywordtype">double</span> t = tik / 5.0;

  <span class="comment">// Three dots</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(3);

  <span class="comment">// Dot 1:</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(3000);  <span class="comment">// X coordinate (mm)</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>((<span class="keywordtype">int</span>) (sin(t) * 1000));<span class="comment">// Y</span>

  <span class="comment">// Dot 2:</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(3500);  <span class="comment">// X</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>((<span class="keywordtype">int</span>) (sin(t+500) * 1000));<span class="comment">// Y</span>

  <span class="comment">// Dot 3:</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(4000);  <span class="comment">// X</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>((<span class="keywordtype">int</span>) (sin(t+1000) * 1000));<span class="comment">// Y</span>

  client-&gt;sendPacketUdp(&amp;reply);
}

<span class="keywordtype">void</span> <a class="code" href="drawingsExample_8cpp.html#a2">exampleXDrawingNetCallback</a>(<a class="code" href="classArServerClient.html">ArServerClient</a>* client, <a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt) {
  <a class="code" href="classArNetPacket.html">ArNetPacket</a> reply;

  <span class="comment">// X marks the spot. 2 line segments, so 4 vertices:</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(4);

  <span class="comment">// Segment 1:</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-4250); <span class="comment">// X1</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(250);   <span class="comment">// Y1</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-3750); <span class="comment">// X2</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-250);  <span class="comment">// Y2</span>

  <span class="comment">// Segment 2:</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-4250); <span class="comment">// X1</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-250);  <span class="comment">// Y1</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(-3750); <span class="comment">// X2</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(250);   <span class="comment">// Y2</span>
  
  client-&gt;sendPacketUdp(&amp;reply);
}

<span class="keywordtype">void</span> <a class="code" href="drawingsExample_8cpp.html#a3">exampleArrowsDrawingNetCallback</a>(<a class="code" href="classArServerClient.html">ArServerClient</a>* client, <a class="code" href="classArNetPacket.html">ArNetPacket</a>* requestPkt) {
  <span class="comment">// 1 Arrow that points at the robot</span>
  <a class="code" href="classArNetPacket.html">ArNetPacket</a> reply;
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(1);
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(0);      <span class="comment">// Pos. X</span>
  reply.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBasePacket.html#a12">byte4ToBuf</a>(700);   <span class="comment">// Pos. Y</span>
  client-&gt;sendPacketUdp(&amp;reply);
}

</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:55 2010 for ArNetworking by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
