<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ArNetworking: simpleServerExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>simpleServerExample.cpp</h1>This is a simple example of an ArNetworking server. This server provides range sensor data to the client, and teleoperation controls. It also includes an example of a custom command (using <a class="el" href="classArServerHandlerCommands.html">ArServerHandlerCommands</a>).<p>
For a more complete server, see <a class="el" href="serverDemo_8cpp.html">serverDemo.cpp</a>.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>
<span class="preprocessor">#include "<a class="code" href="ArNetworking_8h.html">ArNetworking.h</a>"</span>


<span class="comment">/* This function is called ArServerHandlerCommands when our custom command is</span>
<span class="comment"> * recieved. */</span>
<span class="keywordtype">void</span> <a name="a217"></a><a class="code" href="simpleServerExample_8cpp.html#a0">customCommandHandler</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentBuilder.html">ArArgumentBuilder</a> *args)
{
  <span class="keywordflow">if</span>(args &amp;&amp; args-&gt;<a name="a218"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentBuilder.html#a9">getArg</a>(0))
    <a name="a219"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a name="a220"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Recieved custom command with argument \"%s\"."</span>, args-&gt;<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentBuilder.html#a9">getArg</a>(0));
  <span class="keywordflow">else</span> 
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Recieved custom command with no arguments."</span>);
}


<span class="keywordtype">int</span> <a name="a221"></a><a class="code" href="clientCommandLister_8cpp.html#a0">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a222"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e23">Aria::init</a>();
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html">ArRobot</a> robot;
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentParser.html">ArArgumentParser</a> parser(&amp;argc, argv);
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArSimpleConnector.html">ArSimpleConnector</a> simpleConnector(&amp;parser);

  <span class="comment">// The base server object, manages all connections to clients.</span>
  <a name="_a223"></a><a class="code" href="classArServerBase.html">ArServerBase</a> server;

  <span class="comment">// This object simplifies configuration and opening of the ArServerBase</span>
  <span class="comment">// object.</span>
  <a name="_a224"></a><a class="code" href="classArServerSimpleOpener.html">ArServerSimpleOpener</a> simpleOpener(&amp;parser);

  <span class="comment">// parse the command line. fail and print the help if the parsing fails</span>
  <span class="comment">// or if the help was requested with -help</span>
  parser.loadDefaultArguments();
  <span class="keywordflow">if</span> (!simpleConnector.parseArgs() || !simpleOpener.parseArgs() || 
      !parser.checkHelpAndWarnUnparsed())
  {    
    simpleConnector.logOptions();
    simpleOpener.logOptions();
    exit(1);
  }

  <span class="comment">// Use the ArSimpleOpener to open the server port</span>
  <span class="keywordflow">if</span> (!simpleOpener.open(&amp;server))
  {
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(ArLog::Terse, <span class="stringliteral">"Error: Could not open server on port %d"</span>, simpleOpener.getPort());
    exit(1);
  }


  <span class="comment">//</span>
  <span class="comment">// Create services attached to the base server:</span>
  <span class="comment">// </span>
  
  <span class="comment">// Robot position etc.:</span>
  <a name="_a225"></a><a class="code" href="classArServerInfoRobot.html">ArServerInfoRobot</a> serverInfoRobot(&amp;server, &amp;robot);

  <span class="comment">// Robot control modes (only one mode can be active at once):</span>
  <a name="_a226"></a><a class="code" href="classArServerModeStop.html">ArServerModeStop</a> modeStop(&amp;server, &amp;robot);    
  <span class="comment">// old ArServerModeDrive modeDrive(&amp;server, &amp;robot); </span>
  <a name="_a227"></a><a class="code" href="classArServerModeRatioDrive.html">ArServerModeRatioDrive</a> modeRatioDrive(&amp;server, &amp;robot);
  <a name="_a228"></a><a class="code" href="classArServerModeWander.html">ArServerModeWander</a> modeWander(&amp;server, &amp;robot);
  modeStop.addAsDefaultMode();
  modeStop.activate();

  <span class="comment">// This provides a simple way to add new commands.</span>
  <a name="_a229"></a><a class="code" href="classArServerHandlerCommands.html">ArServerHandlerCommands</a> commands(&amp;server);

  <span class="comment">// Add our custom command. ArServerHandlerCommands also has other methods</span>
  <span class="comment">// for adding commands taht take different kinds of arguments, or no</span>
  <span class="comment">// arguments.</span>
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArGlobalFunctor1.html">ArGlobalFunctor1&lt;ArArgumentBuilder*&gt;</a> customCommandFunctor(&amp;<a class="code" href="simpleServerExample_8cpp.html#a0">customCommandHandler</a>);
  commands.addStringCommand(<span class="stringliteral">"ExampleCustomCommand"</span>, <span class="stringliteral">"Example of a custom command. simpleServerExample will print out the text sent with the command."</span>, &amp;customCommandFunctor);
 
  <span class="comment">// These objects provide various debugging and diagnostic custom commands:</span>
  <a name="_a230"></a><a class="code" href="classArServerSimpleComUC.html">ArServerSimpleComUC</a> uCCommands(&amp;commands, &amp;robot);  <span class="comment">// Get information about the robot</span>
  <a name="_a231"></a><a class="code" href="classArServerSimpleComMovementLogging.html">ArServerSimpleComMovementLogging</a> loggingCommands(&amp;commands, &amp;robot);  <span class="comment">// Control logging</span>
  modeRatioDrive.addControlCommands(&amp;commands);  <span class="comment">// Drive mode diagnostics</span>

  <span class="comment">// This provides the client (e.g. MobileEyes) with a simple table of string values</span>
  <span class="comment">// (called an InfoGroup). An InfoGroup is kept globally by Aria.</span>
  <span class="comment">// The values in the table sent to clients are retrieved periodically by calling a </span>
  <span class="comment">// functor.</span>
  <a name="_a232"></a><a class="code" href="classArServerInfoStrings.html">ArServerInfoStrings</a> stringInfo(&amp;server);
  <a name="a233"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e16">Aria::getInfoGroup</a>()-&gt;addAddStringCallback(stringInfo.getAddStringFunctor());

  <span class="comment">// Here are some example entries in the InfoGroup:</span>
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e16">Aria::getInfoGroup</a>()-&gt;addStringInt(
          <span class="stringliteral">"Motor Packet Count"</span>, 10, 
          <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArConstRetFunctorC.html">ArConstRetFunctorC&lt;int, ArRobot&gt;</a>(&amp;robot, 
                                               &amp;<a name="a234"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a119">ArRobot::getMotorPacCount</a>));

  <span class="comment">//</span>
  <span class="comment">// Connect to the robot:</span>
  <span class="comment">// </span>
  
  <span class="keywordflow">if</span> (!simpleConnector.connectRobot(&amp;robot))
  {
    printf(<span class="stringliteral">"Error: Could not connect to robot... exiting\n"</span>);
    <a name="a235"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e37">Aria::shutdown</a>();
    <span class="keywordflow">return</span> 1;
  }


  robot.enableMotors();
  robot.runAsync(<span class="keyword">true</span>);

  <span class="comment">// The simple opener might have information to display right before starting </span>
  <span class="comment">// the server thread:</span>
  simpleOpener.checkAndLog();

  <span class="comment">// now let the server base run in a new thread, accepting client connections.</span>
  server.<a name="a236"></a><a class="code" href="classArServerBase.html#a51">runAsync</a>();

  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#e4">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#w2w5">ArLog::Normal</a>, <span class="stringliteral">"Server is now running... Press Ctrl-C to exit."</span>);

  robot.waitForRunExit();
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#e37">Aria::shutdown</a>();
  exit(0);  
}


</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Jan 7 10:34:55 2010 for ArNetworking by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
